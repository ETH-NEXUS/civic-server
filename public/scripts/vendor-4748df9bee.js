/* global angular */
"use strict";angular.module("yaru22.angular-timeago",[]).directive("timeAgo",["timeAgo","nowTime",function(e,n){return{restrict:"EA",link:function(t,r,i){var a;i.$observe("fromTime",function(n){a=e.parse(n)}),t.$watch(function(){return n()-a},function(n){angular.element(r).text(e.inWords(n))})}}}]).factory("nowTime",["$window","$rootScope",function(e,n){var t=Date.now(),r=function(){e.setTimeout(function(){n.$apply(function(){t=Date.now(),r()})},1e3)};return r(),function(){return t}}]).factory("timeAgo",function(){var e={};return e.settings={refreshMillis:6e4,allowFuture:!1,strings:{en_US:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",numbers:[]},de_DE:{prefixAgo:"vor",prefixFromNow:null,suffixAgo:null,suffixFromNow:"from now",seconds:"weniger als einer Minute",minute:"ca. einer Minute",minutes:"%d Minuten",hour:"ca. einer Stunde",hours:"ca. %d Stunden",day:"einem Tag",days:"%d Tagen",month:"ca. einem Monat",months:"%d Monaten",year:"ca. einem Jahr",years:"%d Jahren",numbers:[]},he_IL:{prefixAgo:null,prefixFromNow:null,suffixAgo:"לפני",suffixFromNow:"מעכשיו",seconds:"פחות מדקה",minute:"כדקה",minutes:"%d דקות",hour:"כשעה",hours:"כ %d שעות",day:"יום",days:"%d ימים",month:"כחודש",months:"%d חודשים",year:"כשנה",years:"%d שנים",numbers:[]}}},e.inWords=function(n){function t(e,t){var r=angular.isFunction(e)?e(t,n):e,a=i.numbers&&i.numbers[t]||t;return r.replace(/%d/i,a)}var r=document.documentElement.lang,i=e.settings.strings[r];"undefined"==typeof i&&(i=e.settings.strings.en_US);var a=i.prefixAgo,o=i.suffixAgo;e.settings.allowFuture&&n<0&&(a=i.prefixFromNow,o=i.suffixFromNow);var c=Math.abs(n)/1e3,s=c/60,u=s/60,d=u/24,m=d/365,g=c<45&&t(i.seconds,Math.round(c))||c<90&&t(i.minute,1)||s<45&&t(i.minutes,Math.round(s))||s<90&&t(i.hour,1)||u<24&&t(i.hours,Math.round(u))||u<42&&t(i.day,1)||d<30&&t(i.days,Math.round(d))||d<45&&t(i.month,1)||d<365&&t(i.months,Math.round(d/30))||m<1.5&&t(i.year,1)||t(i.years,Math.round(m)),l=void 0===i.wordSeparator?" ":i.wordSeparator;return"he_IL"===r?[a,o,g].join(l).trim():[a,g,o].join(l).trim()},e.parse=function(e){if(angular.isNumber(e))return parseInt(e,10);var n=(e||"").trim();return n=n.replace(/\.\d+/,""),n=n.replace(/-/,"/").replace(/-/,"/"),n=n.replace(/T/," ").replace(/Z/," UTC"),n=n.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),new Date(n)},e}).filter("timeAgo",["nowTime","timeAgo",function(e,n){return function(t){var r=n.parse(t),i=e()-r;return n.inWords(i)}}]),function(){function e(e){var n,t=(e.length+8>>6)+1,r=[];for(n=0;n<16*t;n++)r[n]=0;for(n=0;n<e.length;n++)r[n>>2]|=e.charCodeAt(n)<<24-8*(3&n);return r[n>>2]|=128<<24-8*(3&n),r[16*t-1]=8*e.length,r}function n(e){var n,t="0123456789abcdef",r="";for(n=0;n<4*e.length;n++)r+=t.charAt(e[n>>2]>>8*(3-n%4)+4&15)+t.charAt(e[n>>2]>>8*(3-n%4)&15);return r}function t(e){var n,t,c,s,u,d,m,g,l=[],f=1732584193,p=4023233417,h=2562383102,y=271733878,v=3285377520;for(m=0;m<e.length;m+=16){for(n=f,t=p,c=h,s=y,u=v,g=0;g<80;g++)g<16?l[g]=e[m+g]:l[g]=o(l[g-3]^l[g-8]^l[g-14]^l[g-16],1),d=a(a(o(f,5),r(g,p,h,y)),a(a(v,l[g]),i(g))),v=y,y=h,h=o(p,30),p=f,f=d;f=a(f,n),p=a(p,t),h=a(h,c),y=a(y,s),v=a(v,u)}return[f,p,h,y,v]}function r(e,n,t,r){return e<20?n&t|~n&r:e<40?n^t^r:e<60?n&t|n&r|t&r:n^t^r}function i(e){return e<20?1518500249:e<40?1859775393:e<60?2400959708:3395469782}function a(e,n){var t=(65535&e)+(65535&n),r=(e>>16)+(n>>16)+(t>>16);return r<<16|65535&t}function o(e,n){return e<<n|e>>>32-n}function c(r){return n(t(e(r)))}var s=this;"function"==typeof define?define(function(){return c}):"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=c),exports.sha1=c):s.sha1=c}.call(this),function(e,n,t){n.module("angulartics.google.analytics",["angulartics"]).config(["$analyticsProvider",function(r){function i(){var n=e.GoogleAnalyticsObject;return n&&e[n]}function a(){return!n.isUndefined(e._gaq)}function o(e){var n,t={};for(n in e)n.indexOf("dimension")&&n.indexOf("metric")||(t[n]=e[n]);return t}r.settings.pageTracking.trackRelativePath=!0,r.settings.ga={additionalAccountNames:t,additionalAccountHitTypes:{pageview:!0,event:!0,exception:!1,ecommerce:!1,userTiming:!1,setUserProperties:!1,userId:!1},disableEventTracking:null,disablePageTracking:null,userId:null,enhancedEcommerce:!1},r.registerPageTrack(function(e,t){t=t||{},r.settings.ga.disablePageTracking||c("pageview","send",n.extend(o(t),{hitType:"pageview",page:e}))}),r.registerEventTrack(function(t,i){if(!r.settings.ga.disableEventTracking&&(t||t+""=="0")){if(i=i||{},i.category=i.category||"Event",i.value){var a=parseInt(i.value,10);i.value=isNaN(a)?0:a}n.isFunction(i.hitCallback)||(i.hitCallback=null),i.nonInteraction=i.nonInteraction||i.noninteraction,c("event","send",n.extend(o(i),{hitType:"event",eventCategory:i.category,eventAction:t,eventLabel:i.label,eventValue:i.value,nonInteraction:i.nonInteraction,page:i.page||e.location.hash.substring(1)||e.location.pathname,hitCallback:i.hitCallback}))}}),r.registerExceptionTrack(function(n,t){c("exception","send",{hitType:"event",eventCategory:"Exceptions",eventAction:n.toString(),eventLabel:n.stack,nonInteraction:!0,page:e.location.hash.substring(1)||e.location.pathname,isException:!0})}),r.registerSetUsername(function(e){r.settings.ga.userId=e}),r.registerSetUserProperties(function(e){e&&c("setUserProperties","set",o(e))}),r.registerUserTimings(function(t){n.isObject(t)&&!n.isArray(t)&&(n.forEach(["timingCategory","timingVar","timingValue"],function(e){n.isUndefined(t[e])}),c("userTiming","send",{hitType:"timing",timingCategory:t.timingCategory,timingVar:t.timingVar,timingValue:t.timingValue,timingLabel:t.timingLabel,optSampleRate:t.optSampleRate,page:t.page||e.location.hash.substring(1)||e.location.pathname}))}),r.registerTransactionTrack(function(e){var n,t;if(c("ecommerce","require","ecommerce"),c("ecommerce","ecommerce:addTransaction",e),e.products)for(t=0;t<e.products.length;t++)n=e.products[t],n.sku=n.id,n.id=e.id,c("ecommerce","ecommerce:addItem",e.products[t]);e.currencyCode&&c("ecommerce","_set",e.currencyCode),c("ecommerce","ecommerce:send",o(e))});var c=function(){function t(t,i,a){var o,c=e.GoogleAnalyticsObject,s=r.settings.ga.userId;if(s&&n.isObject(i)&&(i.userId=s),t.indexOf("ecommerce:")>-1&&r.settings.ga.enhancedEcommerce)switch(t){case"ecommerce:addTransaction":t=["ec:setAction","purchase"];break;case"ecommerce:addItem":t="ec:addProduct",i.id=i.sku;break;case"ecommerce:send":t="send",i.hitType="event",i.eventCategory="Angulartics Enhanced Ecommerce",i.eventAction="Purchase",i.nonInteraction=!0}"require"===t&&"ecommerce"===i&&r.settings.ga.enhancedEcommerce&&(i="ec"),o=t instanceof Array?t.concat(i):[t,i],e[c].apply(this,o),a&&(s&&!r.settings.ga.additionalAccountHitTypes.userId&&delete i.userId,n.forEach(r.settings.ga.additionalAccountNames,function(n){var t=[].slice.call(o);t[0]=n+"."+t[0],e[c].apply(this,t)}))}function o(t,i,a){if("set"!==t){var o;if("send"===t)switch(i.hitType){case"pageview":o=["_trackPageview",i.page];break;case"event":o=["_trackEvent",i.category,i.action,i.label,i.value,i.nonInteraction];break;case"timing":o=["_trackTiming",i.timingCategory,i.timingVar,i.timingValue,i.timingLabel,i.optSampleRate]}"ecommerce:addTransaction"===t&&(o=["_addTrans",i.id,i.affiliation,i.revenue,i.tax,i.shipping,i.billingCity,i.billingRegion,i.billingCountry]),"ecommerce:addItem"===t&&(o=["_addItem",i.id,i.sku,i.name,i.category,i.price,i.quantity]),"_set"===t&&(o=["_set","currencyCode",i]),"ecommerce:send"===t&&(o=["_trackTrans"]),o&&(e._gaq.push(o),a&&n.forEach(r.settings.ga.additionalAccountNames,function(n){var t=[].slice.call(o);t[0]=n+"."+t[0],e._gaq.push(t)}))}}var c;return a()&&(c=o),i()&&(c=t),c?function(e,n,t){var i=r.settings.ga.additionalAccountHitTypes[e];c(n,t,i)}:n.noop}()}])}(window,window.angular);