/* global angular */
"use strict";angular.module("yaru22.angular-timeago",[]).directive("timeAgo",["timeAgo","nowTime",function(e,n){return{restrict:"EA",link:function(t,i,r){var a;r.$observe("fromTime",function(n){a=e.parse(n)}),t.$watch(function(){return n()-a},function(n){angular.element(i).text(e.inWords(n))})}}}]).factory("nowTime",["$window","$rootScope",function(e,n){var t=Date.now(),i=function(){e.setTimeout(function(){n.$apply(function(){t=Date.now(),i()})},1e3)};return i(),function(){return t}}]).factory("timeAgo",function(){var e={};return e.settings={refreshMillis:6e4,allowFuture:!1,strings:{en_US:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",numbers:[]},de_DE:{prefixAgo:"vor",prefixFromNow:null,suffixAgo:null,suffixFromNow:"from now",seconds:"weniger als einer Minute",minute:"ca. einer Minute",minutes:"%d Minuten",hour:"ca. einer Stunde",hours:"ca. %d Stunden",day:"einem Tag",days:"%d Tagen",month:"ca. einem Monat",months:"%d Monaten",year:"ca. einem Jahr",years:"%d Jahren",numbers:[]},he_IL:{prefixAgo:null,prefixFromNow:null,suffixAgo:"לפני",suffixFromNow:"מעכשיו",seconds:"פחות מדקה",minute:"כדקה",minutes:"%d דקות",hour:"כשעה",hours:"כ %d שעות",day:"יום",days:"%d ימים",month:"כחודש",months:"%d חודשים",year:"כשנה",years:"%d שנים",numbers:[]}}},e.inWords=function(n){function t(e,t){var i=angular.isFunction(e)?e(t,n):e,a=r.numbers&&r.numbers[t]||t;return i.replace(/%d/i,a)}var i=document.documentElement.lang,r=e.settings.strings[i];void 0===r&&(r=e.settings.strings.en_US);var a=r.prefixAgo,o=r.suffixAgo;e.settings.allowFuture&&n<0&&(a=r.prefixFromNow,o=r.suffixFromNow);var c=Math.abs(n)/1e3,s=c/60,u=s/60,d=u/24,m=d/365,g=c<45&&t(r.seconds,Math.round(c))||c<90&&t(r.minute,1)||s<45&&t(r.minutes,Math.round(s))||s<90&&t(r.hour,1)||u<24&&t(r.hours,Math.round(u))||u<42&&t(r.day,1)||d<30&&t(r.days,Math.round(d))||d<45&&t(r.month,1)||d<365&&t(r.months,Math.round(d/30))||m<1.5&&t(r.year,1)||t(r.years,Math.round(m)),l=void 0===r.wordSeparator?" ":r.wordSeparator;return"he_IL"===i?[a,o,g].join(l).trim():[a,g,o].join(l).trim()},e.parse=function(e){if(angular.isNumber(e))return parseInt(e,10);var n=(e||"").trim();return n=n.replace(/\.\d+/,""),n=n.replace(/-/,"/").replace(/-/,"/"),n=n.replace(/T/," ").replace(/Z/," UTC"),n=n.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),new Date(n)},e}).filter("timeAgo",["nowTime","timeAgo",function(e,n){return function(t){var i=n.parse(t),r=e()-i;return n.inWords(r)}}]),function(){function e(e){var n,t=1+(e.length+8>>6),i=[];for(n=0;n<16*t;n++)i[n]=0;for(n=0;n<e.length;n++)i[n>>2]|=e.charCodeAt(n)<<24-8*(3&n);return i[n>>2]|=128<<24-8*(3&n),i[16*t-1]=8*e.length,i}function n(e){var n,t="0123456789abcdef",i="";for(n=0;n<4*e.length;n++)i+=t.charAt(e[n>>2]>>8*(3-n%4)+4&15)+t.charAt(e[n>>2]>>8*(3-n%4)&15);return i}function t(e){var n,t,c,s,u,d,m,g,l=[],f=1732584193,p=4023233417,h=2562383102,v=271733878,y=3285377520;for(m=0;m<e.length;m+=16){for(n=f,t=p,c=h,s=v,u=y,g=0;g<80;g++)l[g]=g<16?e[m+g]:o(l[g-3]^l[g-8]^l[g-14]^l[g-16],1),d=a(a(o(f,5),i(g,p,h,v)),a(a(y,l[g]),r(g))),y=v,v=h,h=o(p,30),p=f,f=d;f=a(f,n),p=a(p,t),h=a(h,c),v=a(v,s),y=a(y,u)}return[f,p,h,v,y]}function i(e,n,t,i){return e<20?n&t|~n&i:e<40?n^t^i:e<60?n&t|n&i|t&i:n^t^i}function r(e){return e<20?1518500249:e<40?1859775393:e<60?2400959708:3395469782}function a(e,n){var t=(65535&e)+(65535&n);return(e>>16)+(n>>16)+(t>>16)<<16|65535&t}function o(e,n){return e<<n|e>>>32-n}function c(i){return n(t(e(i)))}var s=this;"function"!=typeof define||(define.amd,0)?"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=c),exports.sha1=c):s.sha1=c:define(function(){return c})}.call(this),function(e,n,t){n.module("angulartics.google.analytics",["angulartics"]).config(["$analyticsProvider",function(t){function i(){var n=e.GoogleAnalyticsObject;return n&&e[n]}function r(){return!n.isUndefined(e._gaq)}function a(e){var n,t={};for(n in e)n.indexOf("dimension")&&n.indexOf("metric")||(t[n]=e[n]);return t}t.settings.pageTracking.trackRelativePath=!0,t.settings.ga={additionalAccountNames:void 0,additionalAccountHitTypes:{pageview:!0,event:!0,exception:!1,ecommerce:!1,userTiming:!1,setUserProperties:!1,userId:!1},disableEventTracking:null,disablePageTracking:null,userId:null,enhancedEcommerce:!1},t.registerPageTrack(function(e,i){i=i||{},t.settings.ga.disablePageTracking||o("pageview","send",n.extend(a(i),{hitType:"pageview",page:e}))}),t.registerEventTrack(function(i,r){if(!t.settings.ga.disableEventTracking&&(i||i+""=="0")){if(r=r||{},r.category=r.category||"Event",r.value){var c=parseInt(r.value,10);r.value=isNaN(c)?0:c}n.isFunction(r.hitCallback)||(r.hitCallback=null),r.nonInteraction=r.nonInteraction||r.noninteraction,o("event","send",n.extend(a(r),{hitType:"event",eventCategory:r.category,eventAction:i,eventLabel:r.label,eventValue:r.value,nonInteraction:r.nonInteraction,page:r.page||e.location.hash.substring(1)||e.location.pathname,hitCallback:r.hitCallback}))}}),t.registerExceptionTrack(function(n,t){o("exception","send",{hitType:"event",eventCategory:"Exceptions",eventAction:n.toString(),eventLabel:n.stack,nonInteraction:!0,page:e.location.hash.substring(1)||e.location.pathname,isException:!0})}),t.registerSetUsername(function(e){t.settings.ga.userId=e}),t.registerSetUserProperties(function(e){e&&o("setUserProperties","set",a(e))}),t.registerUserTimings(function(t){n.isObject(t)&&!n.isArray(t)&&(n.forEach(["timingCategory","timingVar","timingValue"],function(e){n.isUndefined(t[e])}),o("userTiming","send",{hitType:"timing",timingCategory:t.timingCategory,timingVar:t.timingVar,timingValue:t.timingValue,timingLabel:t.timingLabel,optSampleRate:t.optSampleRate,page:t.page||e.location.hash.substring(1)||e.location.pathname}))}),t.registerTransactionTrack(function(e){var n,t;if(o("ecommerce","require","ecommerce"),o("ecommerce","ecommerce:addTransaction",e),e.products)for(t=0;t<e.products.length;t++)n=e.products[t],n.sku=n.id,n.id=e.id,o("ecommerce","ecommerce:addItem",e.products[t]);e.currencyCode&&o("ecommerce","_set",e.currencyCode),o("ecommerce","ecommerce:send",a(e))});var o=function(){function a(i,r,a){var o,c=e.GoogleAnalyticsObject,s=t.settings.ga.userId;if(s&&n.isObject(r)&&(r.userId=s),i.indexOf("ecommerce:")>-1&&t.settings.ga.enhancedEcommerce)switch(i){case"ecommerce:addTransaction":i=["ec:setAction","purchase"];break;case"ecommerce:addItem":i="ec:addProduct",r.id=r.sku;break;case"ecommerce:send":i="send",r.hitType="event",r.eventCategory="Angulartics Enhanced Ecommerce",r.eventAction="Purchase",r.nonInteraction=!0}"require"===i&&"ecommerce"===r&&t.settings.ga.enhancedEcommerce&&(r="ec"),o=i instanceof Array?i.concat(r):[i,r],e[c].apply(this,o),a&&(s&&!t.settings.ga.additionalAccountHitTypes.userId&&delete r.userId,n.forEach(t.settings.ga.additionalAccountNames,function(n){var t=[].slice.call(o);t[0]=n+"."+t[0],e[c].apply(this,t)}))}function o(i,r,a){if("set"!==i){var o;if("send"===i)switch(r.hitType){case"pageview":o=["_trackPageview",r.page];break;case"event":o=["_trackEvent",r.category,r.action,r.label,r.value,r.nonInteraction];break;case"timing":o=["_trackTiming",r.timingCategory,r.timingVar,r.timingValue,r.timingLabel,r.optSampleRate]}"ecommerce:addTransaction"===i&&(o=["_addTrans",r.id,r.affiliation,r.revenue,r.tax,r.shipping,r.billingCity,r.billingRegion,r.billingCountry]),"ecommerce:addItem"===i&&(o=["_addItem",r.id,r.sku,r.name,r.category,r.price,r.quantity]),"_set"===i&&(o=["_set","currencyCode",r]),"ecommerce:send"===i&&(o=["_trackTrans"]),o&&(e._gaq.push(o),a&&n.forEach(t.settings.ga.additionalAccountNames,function(n){var t=[].slice.call(o);t[0]=n+"."+t[0],e._gaq.push(t)}))}}var c;return r()&&(c=o),i()&&(c=a),c?function(e,n,i){var r=t.settings.ga.additionalAccountHitTypes[e];c(n,i,r)}:n.noop}()}])}(window,window.angular);